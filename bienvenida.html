<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Bienvenida</title>
    <link rel="stylesheet" href="styles.css"> 
</head>
<body>
    <div class="container">
        <h1>¡Bienvenido <span id="nombreUsuario"></span>!</h1>
        <p id="horaActual"></p>
        <p id="mensajeAdicional"></p>
        
        <hr>
        
        <button id="logoutButton" style="color: rgb(255, 255, 255); font-weight: bold;">Cerrar Sesión</button>
    </div>

    <script>
        const API_WELCOME_URL = '/autenticacionconjwt/api.php?action=welcome'; 

        const token = localStorage.getItem('authToken');

        async function cargarDatosProtegidos() {

            if (!token) {
                window.location.href = 'no_acceso.html';
                return;
            }

            try {

                const response = await fetch(API_WELCOME_URL, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const data = await response.json();

                if (response.ok) {

                    document.getElementById('nombreUsuario').textContent = data.username;
                    document.getElementById('horaActual').textContent = 'Hora actual: ' + data.hora_actual;
                    document.getElementById('mensajeAdicional').textContent = data.mensaje_adicional;
                } else if (response.status === 403) {
                    console.error('Acceso denegado:', data.message);
                    window.location.href = 'no_acceso.html';
                } else {
                    console.error('Error al obtener datos:', data.message);
                    window.location.href = 'no_acceso.html';
                }

            } catch (error) {
                console.error('Error de red al llamar a la API:', error);
                window.location.href = 'no_acceso.html';
            }
        }

        document.getElementById('logoutButton').addEventListener('click', function() {
            localStorage.removeItem('authToken');
            window.location.href = 'login.html';
        });

        cargarDatosProtegidos();
    </script>
</body>
</html>